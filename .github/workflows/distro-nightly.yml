name: Distro build

on:
  push:
    branches:
      - master
  schedule:
    - cron: '50 23 * * *'

jobs:
  nightly-tag:
    runs-on: ubuntu-20.04
    name: create nightly tag
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ matrix.branch }}
      - name: get the last commit of day
        id: last-commit-of-day
        run: |
          hash=$(git --no-pager log -1 --format="%h" --since=23.hours)
          echo "::set-output name=COMMITHASH::${hash}"
      - name: Get current date
        id: date
        run: echo "::set-output name=NOW::$(date +'%Y%m%d')"
      - uses: rickstaa/action-create-tag@v1
        if: steps.last-commit-of-day.outputs.COMMITHASH
        with:
          tag: vL.N${{ steps.date.outputs.NOW }}${{steps.last-commit-of-day.outputs.COMMITHASH}}
          message: Limonero Nightly Tag (${{ steps.date.outputs.NOW }}) - Commit(${{ steps.last-commit-of-day.outputs.COMMITHASH }})
